apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "hawkfish.fullname" . }}-config
  labels:
    {{- include "hawkfish.labels" . | nindent 4 }}
data:
  hawkfish.toml: |
    # HawkFish Configuration
    # Generated from Helm values
    
    [api]
    host = "{{ .Values.hawkfish.api.host }}"
    port = {{ .Values.hawkfish.api.port }}
    
    [auth]
    mode = "{{ .Values.hawkfish.auth.mode }}"
    
    [tls]
    mode = "{{ .Values.hawkfish.tls.mode }}"
    
    [ui]
    enabled = {{ .Values.hawkfish.ui.enabled }}
    
    [libvirt]
    uri = "{{ .Values.hawkfish.libvirt.uri }}"
    
    [libvirt.pool]
    min = {{ .Values.hawkfish.libvirt.pool.min }}
    max = {{ .Values.hawkfish.libvirt.pool.max }}
    ttl_sec = {{ .Values.hawkfish.libvirt.pool.ttlSec }}
    
    [storage]
    state_dir = "{{ .Values.hawkfish.storage.stateDir }}"
    iso_dir = "{{ .Values.hawkfish.storage.isoDir }}"
    
    {{- if .Values.hawkfish.hosts }}
    # Pre-configured libvirt hosts
    {{- range $index, $host := .Values.hawkfish.hosts }}
    [[hosts]]
    uri = "{{ $host.uri }}"
    name = "{{ $host.name }}"
    {{- if $host.labels }}
    [hosts.labels]
    {{- range $key, $value := $host.labels }}
    {{ $key }} = "{{ $value }}"
    {{- end }}
    {{- end }}
    {{- end }}
    {{- end }}
    
    {{- if .Values.config.extra }}
    # Additional configuration
    {{ .Values.config.extra | nindent 4 }}
    {{- end }}
